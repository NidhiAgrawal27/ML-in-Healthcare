# Project 3: Interpretable Medical Image Classification

<p align="center">
  <a href="#about">About</a> •
  <a href="#setup-and-usage">Setup and Usage</a> •
  <a href="#requirements">Requirements</a> •
  <a href="#reproducibility">Reproducibility</a>
</p>

## About
This repository contains the code and report for interpretable brain tumor detection as part of project 3 for the course [Machine Learning for Healthcare 2022](http://www.vvz.ethz.ch/lerneinheitPre.do?semkez=2022S&lerneinheitId=158957&lang=en). The following is a brief overview of the repository:
- [data](./data/): contains all data files.
- [logs](./logs/): contains all log files generated during execution (not included in the repository except for figures generated).
- [report](./report/): contains all files used to generate the report in LaTeX.
- [src](./src/): contains all source code files.

## Setup and usage
### Local
1. Install Conda environment from [project3.yml](project3.yml) (note: this environment was created on an M1 MacBook running macOS and may not work on other systems, see [Requirements](#requirements) below for a list of main dependencies).
```bash
conda env create -f project3.yml  --name <custom_name>
```
2. Load the installed environment.
```bash
conda activate <custom_name>
```
3. Execute the [run script](./src/run.sh):
```bash
cd src
./run.sh
```
4. Results are by default saved in the [logs](./logs/) directory. All figures and tables used in the report are further generated and saved in [logs/figures](./logs/figures/).

### Decision tree visualization
The visualization of the decision tree model is generated by calling `plots.plot_decision_tree(...)` as done in [visualize.py](./src/visualization/visualize.py). It is outcommented and not executed by default due to requiring additional dependencies.

To run do the following:
1. Follow the installation guide as described in the [dtreeviz repository](https://github.com/parrt/dtreeviz).
2. Uncomment `plots.plot_decision_tree(...)` function call in [visualize.py](./src/visualization/visualize.py).
3. Uncomment `from dtreeviz.trees import dtreeviz` import in [plots.py](./src/visualization/plots.py).
4. Rerun the visualization inside the [src directory](./src/) (after executing the [run script](./src/run.sh) earlier).
```bash
cd src
python -m visualization.visualize
```
4. Convert the generated [decision_tree.svg](./logs/figures/decision_tree.svg) file inside the [logs/figures](./logs/figures/) directory to a PDF file using e.g. inkscape or [cloudconvert](https://cloudconvert.com/svg-to-pdf).

## Requirements
* `tensorflow`
* `torch`
* `torchvision`
* `scikit-learn`
* `matplotlib`
* `numpy`
* `pandas`
* `shap`
* `lime`
* OPTIONAL: `dtreeviz`

## Reproducibility
All experiments are run with a fixed global seed (determined by argument `--seed`) to ensure reproducibility. Unfortunately, actual results may differ slightly due to some unknown stochastic behaviour. Rerunning the experiments may therefore produce slightly different figures and tables of the results.
